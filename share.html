<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Share Your Life Lessons</title>
  <!-- Social/OG meta -->
  <meta name="description" content="Share your life lessons with other readers of Life Lessons of a Manâ€‘Child by R.C. Howard.">
  <meta property="og:title" content="Share Your Life Lessons">
  <meta property="og:description" content="Leave a lesson or story for other readers.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="Book-Cover.png">
  <meta property="og:image:alt" content="Life Lessons of a Manâ€‘Child book cover">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Share Your Life Lessons">
  <meta name="twitter:description" content="Leave a lesson or story for other readers.">
  <meta name="twitter:image" content="Book-Cover.png">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Roboto', sans-serif;
      background-image: url('PaperbackCoverFinal.png'), url('Book-Cover.png');
      background-repeat: no-repeat; background-position: center center; background-attachment: fixed; background-size: cover;
      min-height: 100vh; position: relative; overflow-x: hidden;
    }
    body::before { content: ''; position: fixed; inset: 0; z-index: 1;
      background: linear-gradient(rgba(20,0,40,0.55), rgba(40,0,80,0.55)),
                  radial-gradient(circle at 50% 50%, rgba(255,0,150,0.05) 0%, transparent 50%); }
    body::after { content: ''; position: fixed; inset: 0; z-index: 2; pointer-events: none;
      background-image: linear-gradient(rgba(0,255,255,0.06) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(0,255,255,0.06) 1px, transparent 1px);
      background-size: 50px 50px; animation: gridMove 20s linear infinite; }
    @keyframes gridMove { 0%{transform:translate(0,0)} 100%{transform:translate(50px,50px)} }
    .scanlines { position: fixed; inset: 0; z-index: 3; pointer-events:none;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,255,0.02) 2px, rgba(0,255,255,0.02) 4px);
      animation: scanlineFlicker .1s linear infinite; }
    @keyframes scanlineFlicker { 0%,99%{opacity:1} 100%{opacity:.98} }

    .container { position: relative; z-index: 10; max-width: 900px; margin: 0 auto; padding: 2rem; min-height: 100vh; }
    .main-content { background: rgba(0,0,0,0.6); border: 2px solid #00ffff; border-radius: 10px; padding: 2rem;
      box-shadow: 0 0 20px rgba(0,255,255,0.35), inset 0 0 20px rgba(0,255,255,0.08); backdrop-filter: blur(2px);
      animation: borderGlow 2s ease-in-out infinite alternate; }
    @keyframes borderGlow { 0%{box-shadow:0 0 20px rgba(0,255,255,.35), inset 0 0 20px rgba(0,255,255,.08)} 100%{box-shadow:0 0 30px rgba(0,255,255,.6), inset 0 0 30px rgba(0,255,255,.12)} }

    .title { font-family: 'Orbitron', monospace; font-size: 2rem; font-weight: 900; color: #00ffff; text-align: center;
      text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; margin-bottom: .6rem; animation: titlePulse 3s ease-in-out infinite; }
    @keyframes titlePulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.02)} }

    .subtitle { font-family: 'Press Start 2P', monospace; font-size: .7rem; color: #ff00ff; text-shadow: 0 0 10px #ff00ff; text-align: center; margin-bottom: 1.2rem; }

    .back-row { text-align: center; margin-top: 1.5rem; }
    .back-link { display: inline-block; padding: .8rem 2rem; background: linear-gradient(45deg, #1a0033, #330066);
      border: 2px solid #00ffff; border-radius: 25px; color: #00ffff; font-family: 'Press Start 2P', monospace; font-size: .8rem; text-decoration: none;
      box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; transition: all .25s ease; }
    .back-link:hover { background: linear-gradient(45deg, #ff00ff, #330066); color: #ff00ff; border-color: #ff00ff; box-shadow: 0 0 20px #ff00ff, 0 0 40px #ff00ff; }

    .note { color:#cccccc; text-align:center; font-size:.85rem; margin-bottom:1rem; }

    @media (prefers-reduced-motion: reduce){ *{animation:none !important; transition:none !important} body::after,.scanlines{animation:none !important} }
  </style>
</head>
<body>
  <div class="scanlines"></div>
  <div class="container">
    <div class="main-content">
      <h1 class="title">SHARE YOUR LIFE LESSONS</h1>
      <div class="subtitle">Be kind. Be helpful. Be you.</div>
      <p class="note">Share a lesson or story below. Submissions are public on this page after posting. Keep it kind; the site owner may remove offensive content.</p>

      <form id="lesson-form" class="back-row" style="margin-top:1.5rem;">
        <input type="text" id="name" name="name" placeholder="Your name (optional)" maxlength="60" 
               style="display:block; width:100%; max-width:640px; margin:0 auto 1rem; padding:.6rem; border-radius:8px; border:1px solid #00ffff; background:#0a0a0a; color:#e9f9ff;">
        <textarea id="message" name="message" placeholder="Your life lessonâ€¦" maxlength="1000" required
               style="display:block; width:100%; max-width:640px; height:140px; margin:0 auto 1.2rem; padding:.6rem; border-radius:8px; border:1px solid #00ffff; background:#0a0a0a; color:#e9f9ff;"></textarea>
        <input type="text" id="website" name="website" autocomplete="off" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px;">
        <button type="submit" class="back-link" id="submitBtn">Submit Lesson</button>
        <div id="formMsg" class="note" style="margin-top:.6rem; display:none;"></div>
      </form>

      <div id="lessons" style="margin-top:1.5rem;">
        <div id="lessons-list" style="display:grid; gap:.75rem;"></div>
      </div>

      <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js';
        import { getFirestore, collection, addDoc, deleteDoc, doc, serverTimestamp, query, orderBy, limit, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js';

        const firebaseConfig = {
          apiKey: "AIzaSyAwlafCdLfRWoJr62eglzp3TN1coHocnqM",
          authDomain: "life-lessons-1138.firebaseapp.com",
          projectId: "life-lessons-1138"
        };

        const notConfigured = !firebaseConfig.apiKey || firebaseConfig.apiKey.startsWith('YOUR_');
        const form = document.getElementById('lesson-form');
        const btn = document.getElementById('submitBtn');
        const msg = document.getElementById('formMsg');
        const list = document.getElementById('lessons-list');

        if (notConfigured) {
          form.style.display = 'none';
          const note = document.querySelector('#lessons .note');
          if (note) note.textContent = 'Comments disabled. Site owner: add your Firebase config in share.html to enable submissions.';
        } else {
          const app = initializeApp(firebaseConfig);
          const db = getFirestore(app);
          const auth = getAuth(app);
          btn.disabled = true;

          signInAnonymously(auth).catch(() => {}).finally(() => { btn.disabled = false; });

          const q = query(collection(db, 'lessons'), orderBy('createdAt', 'desc'), limit(25));
          onSnapshot(q, (snap) => {
            list.innerHTML = '';
            if (snap.empty) {
              const d = document.createElement('div');
              d.className = 'note';
              d.textContent = 'No lessons yet. Be the first to share!';
              list.appendChild(d);
              return;
            }
            snap.forEach(docSnap => {
              const data = docSnap.data();
              const item = document.createElement('div');
              item.style.padding = '.8rem';
              item.style.border = '1px solid #00ffff';
              item.style.borderRadius = '10px';
              item.style.background = 'rgba(0,0,0,0.45)';
              item.style.position = 'relative';
              const who = document.createElement('div');
              who.style.color = '#00ffff';
              who.style.fontFamily = "'Press Start 2P', monospace";
              who.style.fontSize = '.7rem';
              who.textContent = (data.name || 'Anonymous');
              const text = document.createElement('div');
              text.style.marginTop = '.4rem';
              text.style.whiteSpace = 'pre-wrap';
              text.style.lineHeight = '1.5';
              text.style.color = '#e9f9ff';
              text.textContent = data.message || '';
              item.appendChild(who);
              item.appendChild(text);
              // Add delete button if user owns this lesson
              if (auth.currentUser && data.uid === auth.currentUser.uid) {
                const delBtn = document.createElement('button');
                delBtn.textContent = 'ðŸ—‘ï¸';
                delBtn.style.position = 'absolute';
                delBtn.style.top = '.6rem';
                delBtn.style.right = '.6rem';
                delBtn.style.background = 'rgba(255,0,100,0.2)';
                delBtn.style.border = '1px solid #ff0066';
                delBtn.style.borderRadius = '6px';
                delBtn.style.padding = '.3rem .5rem';
                delBtn.style.cursor = 'pointer';
                delBtn.style.fontSize = '1rem';
                delBtn.title = 'Delete your lesson';
                delBtn.addEventListener('click', async () => {
                  if (!confirm('Delete this lesson?')) return;
                  try {
                    await deleteDoc(doc(db, 'lessons', docSnap.id));
                  } catch (err) {
                    alert('Could not delete. Please try again.');
                  }
                });
                item.appendChild(delBtn);
              }
              list.appendChild(item);
            });
          });

          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            msg.style.display = 'none';
            if (document.getElementById('website').value) return; // honeypot
            const name = (document.getElementById('name').value || '').trim().slice(0,60);
            const message = (document.getElementById('message').value || '').trim();
            if (!message) return;
            if (message.length > 1000) return;
            btn.disabled = true;
            try {
              await addDoc(collection(db, 'lessons'), { name, message, uid: auth.currentUser.uid, createdAt: serverTimestamp() });
              document.getElementById('name').value = '';
              document.getElementById('message').value = '';
              msg.textContent = 'Thanks for sharing!';
              msg.style.display = 'block';
            } catch (err) {
              msg.textContent = 'Could not post right now. Please try again.';
              msg.style.display = 'block';
            } finally {
              btn.disabled = false;
            }
          });
        }
      </script>

      <div class="back-row">
        <a href="index.html" class="back-link">â—€ BACK TO HOME</a>
      </div>
    </div>
  </div>
</body>
</html>
